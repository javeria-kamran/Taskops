# Phase III: AI Chatbot - Project Overview

## Project Vision

Transform the Phase II web application into an AI-powered conversational interface using the Model Context Protocol (MCP) architecture, allowing users to manage tasks through natural language.

## Current Phase: Phase III - AI Chatbot with MCP

**Status**: Planned
**Target Date**: TBD
**Objective**: Create an AI-powered chatbot that manages todos through natural language using MCP server architecture with OpenAI Agents SDK.

## Phase Evolution

### Phase I: Console Application âœ…
- **Status**: Completed
- **Features**: 5 basic CRUD operations via CLI
- **Interface**: Command-line menu
- **Storage**: In-memory

### Phase II: Web Application âœ…
- **Status**: Completed (or In Progress)
- **Features**: All Phase I features + web UI + authentication
- **Interface**: Responsive web application
- **Storage**: Neon PostgreSQL
- **Users**: Multi-user with Better Auth + JWT

### Phase III: AI Chatbot ðŸš§
- **Status**: In Progress
- **Features**: All Phase II features + conversational AI interface
- **Interface**: Natural language via OpenAI ChatKit
- **AI**: OpenAI Agents SDK with MCP tools
- **Architecture**: Stateless chat endpoint with database-persisted conversations

### Phase IV: Kubernetes (Planned)
- **Deployment**: Local Kubernetes cluster
- **Orchestration**: K8s manifests, services, ingress

### Phase V: Cloud-Native (Planned)
- **Deployment**: Cloud platform
- **Features**: Event streaming (Kafka), microservices (Dapr)

## Core Features (Phase III)

### 1. Conversational Task Management
- Create tasks through natural language
- List/filter tasks by asking questions
- Complete tasks by saying "done"
- Update tasks by describing changes
- Delete tasks conversationally

### 2. MCP Server Architecture
- MCP tools expose task operations
- Standardized interface for AI agent
- Stateless tool execution
- Database-persisted state

### 3. Stateless Chat Endpoint
- Single `/api/chat` endpoint
- Fetches conversation history from database
- Stores messages after each turn
- No server-side session state
- Scalable and resilient

### 4. OpenAI Agents SDK Integration
- Agent orchestrates tool calls
- Natural language understanding
- Multi-step reasoning
- Friendly confirmations

### 5. Conversation Persistence
- Store all messages in database
- Resume conversations after server restart
- Multiple concurrent conversations per user
- Conversation history accessible

## Technology Stack

### Frontend
- **Framework**: Next.js 16+ (from Phase II)
- **Chat UI**: OpenAI ChatKit
- **Language**: TypeScript
- **Auth**: Better Auth (existing)

### Backend
- **Framework**: FastAPI (existing)
- **AI Framework**: OpenAI Agents SDK
- **MCP**: Official MCP SDK
- **Language**: Python 3.13+
- **ORM**: SQLModel (existing)
- **Testing**: pytest

### Database
- **Primary**: Neon Serverless PostgreSQL (existing)
- **New Tables**: conversations, messages

### Authentication
- **Library**: Better Auth (existing from Phase II)
- **Method**: JWT tokens
- **User Isolation**: All operations filtered by `user_id`

### Infrastructure
- **Development**: Docker Compose (extended from Phase II)
- **ChatKit Hosting**: Vercel or similar (for domain allowlist)

## Development Approach

### Spec-Driven Development
1. **Write Specifications**: Define chatbot behavior and MCP tools in `/specs/003-phase3-chatbot`
2. **Generate Plans**: Claude Code creates implementation plans
3. **Break into Tasks**: Plans broken into atomic tasks
4. **Implement**: Claude Code implements from tasks
5. **No Manual Coding**: All code generated by Claude Code

### Workflow
```
User Requirement
  â†’ Write Spec (@specs/003-phase3-chatbot/[feature].md)
  â†’ Claude Code Reads Specs
  â†’ Claude Code Generates Plan
  â†’ Claude Code Implements Backend (MCP + Chat) + Frontend (ChatKit)
  â†’ User Tests Conversational Interface
  â†’ Iterate on Spec if Needed
```

## Repository Structure

```
Naz Todo/
â”œâ”€â”€ .spec-kit/
â”‚   â””â”€â”€ config.yaml                    # Updated for Phase III
â”œâ”€â”€ specs/
â”‚   â”œâ”€â”€ 001-phase1-console-app/        # Phase I specs
â”‚   â”œâ”€â”€ 002-phase2-web-app/            # Phase II specs
â”‚   â””â”€â”€ 003-phase3-chatbot/            # Phase III specs (this phase)
â”‚       â”œâ”€â”€ overview.md                # This file
â”‚       â”œâ”€â”€ architecture.md            # Stateless chat + MCP architecture
â”‚       â”œâ”€â”€ features/
â”‚       â”‚   â”œâ”€â”€ chatbot.md             # Conversational interface
â”‚       â”‚   â””â”€â”€ mcp-tools.md           # MCP tool specifications
â”‚       â”œâ”€â”€ api/
â”‚       â”‚   â”œâ”€â”€ chat-endpoint.md       # POST /api/chat specification
â”‚       â”‚   â””â”€â”€ mcp-server.md          # MCP server implementation
â”‚       â”œâ”€â”€ database/
â”‚       â”‚   â””â”€â”€ schema.md              # conversations + messages tables
â”‚       â””â”€â”€ ui/
â”‚           â””â”€â”€ chatkit-integration.md # ChatKit setup and integration
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ (app)/
â”‚   â”‚   â”‚   â”œâ”€â”€ tasks/                 # Phase II web UI (still available)
â”‚   â”‚   â”‚   â””â”€â”€ chat/                  # NEW: ChatKit interface
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ ...
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”‚   â”œâ”€â”€ tasks.py               # Phase II REST endpoints (still available)
â”‚   â”‚   â”‚   â””â”€â”€ chat.py                # NEW: Chat endpoint
â”‚   â”‚   â”œâ”€â”€ mcp/
â”‚   â”‚   â”‚   â”œâ”€â”€ server.py              # NEW: MCP server
â”‚   â”‚   â”‚   â””â”€â”€ tools.py               # NEW: MCP tool definitions
â”‚   â”‚   â”œâ”€â”€ agents/
â”‚   â”‚   â”‚   â””â”€â”€ task_agent.py          # NEW: OpenAI agent logic
â”‚   â”‚   â””â”€â”€ models/
â”‚   â”‚       â”œâ”€â”€ task.py                # Existing
â”‚   â”‚       â”œâ”€â”€ conversation.py        # NEW
â”‚   â”‚       â””â”€â”€ message.py             # NEW
â”‚   â””â”€â”€ ...
â””â”€â”€ ...
```

## Success Criteria (Phase III)

### Functional
- âœ… Users can create tasks via natural language
- âœ… Users can list/filter tasks by asking
- âœ… Users can complete tasks conversationally
- âœ… Users can update/delete tasks via chat
- âœ… Conversation context maintained across messages
- âœ… Conversations resume after server restart
- âœ… AI provides friendly confirmations

### Technical
- âœ… MCP server implements all 5 tools (add, list, complete, update, delete)
- âœ… Chat endpoint is stateless
- âœ… All conversation state persisted to database
- âœ… >80% test coverage on MCP tools
- âœ… Agent successfully orchestrates multi-step tasks
- âœ… OpenAI ChatKit integrated and working

### User Experience
- âœ… Natural language understanding works for common phrases
- âœ… Agent asks for clarification when needed
- âœ… Responses are friendly and helpful
- âœ… Error messages are user-friendly
- âœ… Fast response times (<2 seconds for simple queries)

### Security
- âœ… All chat requests authenticated (JWT)
- âœ… User isolation enforced (can't access other users' tasks)
- âœ… MCP tools validate user_id
- âœ… No prompt injection vulnerabilities

## Out of Scope (Phase III Basic Level)

The following are explicitly NOT included in Phase III Basic Level:
- âŒ Advanced NLU (complex multi-sentence commands)
- âŒ Task due dates or reminders via chat
- âŒ Voice interface
- âŒ Multi-language support
- âŒ Task sharing via chat
- âŒ Attachments or file uploads
- âŒ Scheduled tasks
- âŒ Task categorization/tagging
- âŒ Search functionality
- âŒ Analytics or insights

These may be added in future enhancements or phases.

## Key Constraints

### Phase III Constraints
1. **Basic Level Only**: Implement only the 5 core CRUD operations conversationally
2. **Stateless Architecture**: Server holds no conversation state
3. **Database Persistence**: All state (conversations, messages) in database
4. **MCP Standard**: Follow official MCP SDK patterns
5. **OpenAI Agents SDK**: Use official SDK, not custom agent logic

### Technical Constraints
1. **Single Chat Endpoint**: POST /api/chat (no separate endpoints for each operation)
2. **MCP Tools**: Must use Official MCP SDK for tool definitions
3. **Stateless MCP**: Tools don't maintain state between calls
4. **OpenAI ChatKit**: Frontend chat UI must use OpenAI ChatKit
5. **Domain Allowlist**: ChatKit requires domain allowlist configuration

## Migration from Phase II

### What Gets Preserved
- Phase II web UI (still accessible at /tasks)
- REST API endpoints (still functional)
- Authentication (same JWT flow)
- Database schema (extended, not replaced)
- Task CRUD business logic

### What Gets Added
- Chat endpoint (POST /api/chat)
- MCP server with 5 tools
- OpenAI agent integration
- Conversation and message models
- ChatKit UI at /chat route

### Dual Interface Strategy
Phase III provides **two interfaces** for task management:
1. **Web UI** (Phase II): Direct CRUD via forms/buttons at `/tasks`
2. **Chat UI** (Phase III): Conversational interface at `/chat`

Users can use either or both. The chat interface internally calls the same business logic.

## Architecture Benefits

### MCP Tools
- **Standardized**: AI interacts with app via standard protocol
- **Composable**: Agent can chain multiple tools in one turn
- **Testable**: Each tool can be tested independently
- **Reusable**: Same tools can be used by different AI agents

### Stateless Server
- **Scalable**: Horizontal scaling with load balancer
- **Resilient**: Server restarts don't lose conversations
- **Simple**: No session management complexity
- **Testable**: Each request is independent

### Database Persistence
- **Reliable**: Conversations survive crashes
- **Auditable**: Full message history
- **Resumable**: Continue conversations later
- **Analyzable**: Can analyze chat patterns

## Natural Language Examples

### Task Creation
- "Add a task to buy groceries"
- "Remind me to call mom"
- "I need to finish the report by Friday"
- "Create a task: water the plants"

### Task Listing
- "Show me all my tasks"
- "What's on my todo list?"
- "What do I need to do today?"
- "List pending tasks"
- "Show completed items"

### Task Completion
- "Mark task 3 as done"
- "I finished buying groceries"
- "Complete the report task"
- "Task 5 is done"

### Task Updates
- "Change task 1 to 'Call mom tonight'"
- "Update the groceries task to include milk and eggs"
- "Rename task 2"

### Task Deletion
- "Delete task 4"
- "Remove the meeting task"
- "Cancel task about dentist"

## OpenAI ChatKit Setup

### Domain Allowlist Requirement
Before deployment, configure OpenAI's domain allowlist:

1. Deploy frontend to get production URL
2. Add domain at https://platform.openai.com/settings/organization/security/domain-allowlist
3. Get domain key from OpenAI
4. Set `NEXT_PUBLIC_OPENAI_DOMAIN_KEY` in frontend env

**Note**: Localhost works without allowlist (development only)

## Deliverables

### Code
- Frontend: ChatKit integration at `/chat`
- Backend: MCP server + chat endpoint
- Database: Migration scripts for conversations/messages
- Tests: MCP tool tests, chat endpoint tests

### Documentation
- README with setup instructions
- MCP tool documentation
- Agent behavior specification
- Natural language command examples

### Demos
- Video showing conversational task management
- Screenshots of ChatKit interface
- Example conversation flows

## References

- [OpenAI Agents SDK](https://platform.openai.com/docs/agents)
- [Official MCP SDK](https://modelcontextprotocol.io/)
- [OpenAI ChatKit](https://platform.openai.com/docs/chatkit)
- [FastAPI Documentation](https://fastapi.tiangolo.com/)
- [SQLModel Documentation](https://sqlmodel.tiangolo.com/)

## Document History

| Version | Date | Changes |
|---------|------|---------|
| 1.0 | 2024-12-28 | Initial Phase III overview specification |
